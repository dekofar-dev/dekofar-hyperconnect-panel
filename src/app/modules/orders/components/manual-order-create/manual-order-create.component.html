<div class="card">
  <div class="card-header">
    <h3 class="card-title">Yeni Manuel Sipariş</h3>
  </div>
  <div class="card-body">
    <form [formGroup]="form" (ngSubmit)="submit()">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label>Müşteri Adı *</label>
          <input type="text" formControlName="customerName" class="form-control" required />
        </div>
        <div class="col-md-6 mb-3">
          <label>Müşteri Soyadı</label>
          <input type="text" formControlName="customerSurname" class="form-control" />
        </div>
        <div class="col-md-6 mb-3">
          <label>Telefon</label>
          <input type="text" formControlName="phone" class="form-control" />
        </div>
        <div class="col-md-6 mb-3">
          <label>Email</label>
          <input type="email" formControlName="email" class="form-control" />
        </div>
        <div class="col-md-12 mb-3">
          <label>Adres</label>
          <input type="text" formControlName="address" class="form-control" />
        </div>
        <div class="col-md-6 mb-3">
          <label>İl</label>
          <input type="text" formControlName="city" class="form-control" />
        </div>
        <div class="col-md-6 mb-3">
          <label>İlçe</label>
          <input type="text" formControlName="district" class="form-control" />
        </div>
        <div class="col-md-6 mb-3">
          <label>Ödeme Tipi</label>
          <select class="form-select" formControlName="paymentType">
            <option value="Havale">Havale</option>
            <option value="Kredi Kartı">Kredi Kartı</option>
            <option value="Kapıda Ödeme">Kapıda Ödeme</option>
          </select>
        </div>
        <div class="col-md-6 mb-3">
          <label>İndirim Adı</label>
          <input type="text" formControlName="discountName" class="form-control" />
        </div>
        <div class="col-md-12 mb-3">
          <label>Sipariş Notu</label>
          <textarea class="form-control" formControlName="orderNote"></textarea>
        </div>
      </div>

      <hr />
      <h5>Ürünler</h5>

      <div formArrayName="items">
        <div *ngFor="let item of items.controls; let i = index" [formGroupName]="i" class="row align-items-end mb-2">
          <div class="col-md-4">
            <label>Ürün</label>
            <select class="form-select" formControlName="productId" (change)="onProductSelect(i)">
              <option [value]="''">Seçiniz</option>
              <option *ngFor="let p of products" [value]="p.id">{{ p.title }}</option>
            </select>
          </div>
          <div class="col-md-2">
            <label>Adet</label>
            <input type="number" formControlName="quantity" class="form-control" />
          </div>
          <div class="col-md-2">
            <label>Birim Fiyat</label>
            <input type="number" formControlName="price" class="form-control" />
          </div>
          <div class="col-md-3">
            <label>Ürün Adı</label>
            <input type="text" formControlName="productName" class="form-control" readonly />
          </div>
          <div class="col-md-1">
            <button type="button" class="btn btn-sm btn-danger" (click)="removeItem(i)">X</button>
          </div>
        </div>
      </div>

      <button type="button" class="btn btn-outline-secondary my-2" (click)="addItem()">+ Ürün Ekle</button>

      <div *ngIf="errorMessage" class="text-danger">{{ errorMessage }}</div>

      <div class="mt-3">
        <button class="btn btn-primary" [disabled]="isSubmitting">Kaydet</button>
        <a routerLink="/orders" class="btn btn-secondary ms-2">İptal</a>
      </div>
    </form>
  </div>
</div>
