<div class="container-xxl py-5" *ngIf="!loading && ticket">

  <!-- BaÅŸlÄ±k -->
  <div class="mb-5">
    <h3 class="fw-bold">
      ğŸ« Destek Talebi DetayÄ± - <span class="text-primary">{{ ticket.ticketNumber }}</span>
    </h3>
    <p class="text-muted">
      OluÅŸturulma: {{ ticket.createdAt | date:'short' }}
      <br />
      <span class="badge bg-info text-dark mt-2">
        {{ ticket.shopifyOrderId ? 'Shopify SipariÅŸi ReferanslÄ±' : 'Manuel Talep' }}
      </span>
    </p>
  </div>

  <!-- Temel Bilgiler -->
  <div class="row mb-5">
    <div class="col-md-6 mb-3">
      <div class="fw-semibold">ğŸ“Œ Konu:</div>
      <div>{{ ticket.subject }}</div>
    </div>
    <div class="col-md-6 mb-3">
      <div class="fw-semibold">ğŸ“‚ Kategori:</div>
      <div>{{ getCategoryName(ticket.category) }}</div>
    </div>

    <div class="col-md-6 mb-3">
      <div class="fw-semibold">ğŸš¦ Ã–ncelik:</div>
      <div>{{ getPriorityLabel(ticket.priority) }}</div>
    </div>
    <div class="col-md-6 mb-3">
      <div class="fw-semibold">ğŸ“Œ Durum:</div>
      <div>{{ getStatusLabel(ticket.status) }}</div>
    </div>

    <div class="col-md-6 mb-3">
      <div class="fw-semibold">ğŸ“ Telefon:</div>
      <div>{{ ticket.customerPhone || '-' }}</div>
    </div>
    <div class="col-md-6 mb-3">
      <div class="fw-semibold">ğŸ“§ E-posta:</div>
      <div>{{ ticket.customerEmail || '-' }}</div>
    </div>

    <div class="col-md-6 mb-3">
      <div class="fw-semibold">ğŸ›’ Shopify SipariÅŸ ID:</div>
      <div>{{ ticket.shopifyOrderId || '-' }}</div>
    </div>
    <div class="col-md-6 mb-3">
      <div class="fw-semibold">ğŸ·ï¸ Etiketler:</div>
      <div>{{ ticket.tags || '-' }}</div>
    </div>

    <div class="col-md-6 mb-3" *ngIf="ticket.dueDate">
      <div class="fw-semibold">â³ Son YanÄ±tlama Tarihi (SLA):</div>
      <div>{{ ticket.dueDate | date:'shortDate' }}</div>
    </div>
  </div>

  <!-- AÃ§Ä±klama -->
  <div class="mb-5">
    <div class="fw-semibold">ğŸ“ AÃ§Ä±klama:</div>
    <div class="border rounded p-3 bg-light">{{ ticket.description }}</div>
  </div>

  <!-- Dosya Eklentileri -->
  <div class="mb-5" *ngIf="hasAttachments()">
    <h5 class="fw-bold mb-3">ğŸ“ Eklentiler</h5>
    <ul class="list-group">
      <li *ngFor="let file of ticket.attachments" class="list-group-item">
        <a [href]="file.url" target="_blank">{{ file.fileName }}</a>
      </li>
    </ul>
  </div>

  <!-- Notlar -->
  <div class="mb-5" *ngIf="hasNotes()">
    <h5 class="fw-bold mb-3">ğŸ““ Notlar</h5>
    <div class="border rounded bg-white">
      <div *ngFor="let note of ticket.notes" class="border-bottom p-3">
        <div class="fw-semibold">{{ note.createdBy }}</div>
        <div class="text-muted small">{{ note.createdAt | date:'short' }}</div>
        <div class="mt-2">{{ note.message }}</div>
      </div>
    </div>
  </div>

  <!-- Ä°ÅŸlem GeÃ§miÅŸi -->
  <div class="mb-5" *ngIf="hasLogs()">
    <h5 class="fw-bold mb-3">ğŸ“œ Ä°ÅŸlem GeÃ§miÅŸi</h5>
    <ul class="list-group">
      <li *ngFor="let log of ticket.logs" class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <div class="fw-semibold">{{ log.action }}</div>
          <div class="text-muted small">ğŸ‘¤ {{ log.createdBy }} â€” {{ log.createdAt | date:'short' }}</div>
        </div>
      </li>
    </ul>
  </div>

  <!-- Durum GeÃ§miÅŸi -->
  <div *ngIf="hasHistory()">
    <h5 class="fw-bold mb-3">ğŸ•“ Durum GeÃ§miÅŸi</h5>
    <ul class="list-group">
      <li *ngFor="let h of ticket.history" class="list-group-item">
        {{ getStatusLabel(h.status) }} â†’ {{ h.changedBy }} â†’ {{ h.changedAt | date:'short' }}
      </li>
    </ul>
  </div>

  <!-- GÃ¼ncelle -->
  <div class="card mb-5 mt-5">
    <div class="card-header">
      <h5 class="card-title">GÃ¼ncelle</h5>
    </div>
    <div class="card-body">
      <div class="row mb-3">
        <div class="col-md-6">
          <label class="form-label">Durum</label>
          <select class="form-select" [(ngModel)]="selectedStatus">
            <option *ngFor="let s of statusOptions" [ngValue]="s.id">{{ s.label }}</option>
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label">Ã–ncelik</label>
          <select class="form-select" [(ngModel)]="selectedPriority">
            <option *ngFor="let p of priorityOptions" [ngValue]="p.id">{{ p.label }}</option>
          </select>
        </div>
      </div>
      <button class="btn btn-sm btn-primary" (click)="updateTicket()">Kaydet</button>
    </div>
  </div>

  <!-- Not Ekle -->
  <div class="card mb-5">
    <div class="card-header">
      <h5 class="card-title">Not Ekle</h5>
    </div>
    <div class="card-body">
      <textarea class="form-control" rows="3" [(ngModel)]="noteText"></textarea>
      <button class="btn btn-sm btn-light-primary mt-2" (click)="addNote()" [disabled]="!noteText.trim()">Ekle</button>
    </div>
  </div>

</div>

<!-- YÃ¼kleniyor -->
<div class="text-center py-5" *ngIf="loading">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">YÃ¼kleniyor...</span>
  </div>
</div>

<!-- Hata -->
<div class="alert alert-danger" *ngIf="!loading && !ticket">
  Destek talebi bulunamadÄ±.
</div>
