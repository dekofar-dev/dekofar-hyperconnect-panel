<div class="row">
  <!-- Sol: Talep Formu -->
  <div [ngClass]="orderSummary ? 'col-lg-8 mb-4' : 'col-12 mb-4'">
    <div class="card shadow-sm w-100">
      <div class="card-body">
        <h5 class="card-title mb-4">ğŸ« Yeni Destek Talebi OluÅŸtur</h5>

        <form [formGroup]="form" (ngSubmit)="submit()" enctype="multipart/form-data">
          <!-- Talep Kodu -->
          <div class="mb-3">
            <label class="form-label">Talep Kodu</label><br />
            <span class="badge bg-light-primary text-dark px-3 py-2 fs-6">
              {{ ticketCode || 'OluÅŸturulacak' }}
            </span>
          </div>

          <!-- Konu -->
          <div class="mb-3">
            <label class="form-label">Konu</label>
            <input type="text" formControlName="subject" class="form-control" />
          </div>

          <!-- Kategori -->
          <div class="mb-3">
            <label class="form-label">Kategori</label>
            <select formControlName="category" class="form-select">
              <option [ngValue]="null" disabled selected>SeÃ§iniz</option>
              <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.label }}</option>
            </select>
          </div>

          <!-- AÃ§Ä±klama -->
          <div class="mb-3">
            <label class="form-label">AÃ§Ä±klama</label>
            <textarea formControlName="description" rows="5" class="form-control"></textarea>
          </div>

          <!-- Ã–ncelik -->
          <div class="mb-3">
            <label class="form-label">Ã–ncelik</label>
            <select formControlName="priority" class="form-select">
              <option [ngValue]="null" disabled selected>SeÃ§iniz</option>
              <option *ngFor="let prio of priorityOptions" [value]="prio.id">
                {{ prio.label }}
              </option>
            </select>
          </div>

          <!-- Etiketler -->
          <div class="mb-3">
            <label class="form-label">Etiketler</label>
            <input type="text" formControlName="tags" class="form-control" placeholder="Ã–rn: iade, acil" />
            <small class="text-muted">Etiketleri virgÃ¼l ile ayÄ±rabilirsiniz</small>
          </div>

          <!-- Shopify deÄŸilse mÃ¼ÅŸteri bilgileri -->
          <ng-container *ngIf="!isShopifyReference">
            <!-- MÃ¼ÅŸteri AdÄ± -->
            <div class="mb-3">
              <label class="form-label">MÃ¼ÅŸteri AdÄ±</label>
              <input type="text" formControlName="customerName" class="form-control" placeholder="Ad Soyad" />
            </div>

            <!-- MÃ¼ÅŸteri Telefonu -->
            <div class="mb-3">
              <label class="form-label">Telefon</label>
              <input type="text" formControlName="customerPhone" class="form-control" placeholder="5XXXXXXXXX" />
            </div>

            <!-- MÃ¼ÅŸteri E-Posta -->
            <div class="mb-3">
              <label class="form-label">E-posta</label>
              <input type="email" formControlName="customerEmail" class="form-control" placeholder="musteri@site.com" />
            </div>
          </ng-container>

          <!-- Dosya Ekleme -->
          <div class="mb-3">
            <label class="form-label">Dosya Ekle (Opsiyonel)</label>
            <input type="file" class="form-control" (change)="onFileSelected($event)" multiple />
            <small class="text-muted">PDF, JPG, PNG gibi belgeler yÃ¼kleyebilirsiniz</small>
          </div>

          <!-- Eklenen Dosyalar -->
          <div *ngIf="attachedFiles.length > 0" class="mb-3">
            <label class="form-label fw-semibold">Eklenen Dosyalar:</label>
            <ul class="list-group">
              <li *ngFor="let file of attachedFiles" class="list-group-item">{{ file.name }}</li>
            </ul>
          </div>

          <!-- GÃ¶nder Butonu -->
          <div class="d-grid mt-4">
            <button type="submit" class="btn btn-primary" [disabled]="form.invalid || loading">
              <span *ngIf="!loading">ğŸ“¨ Talebi GÃ¶nder</span>
              <span *ngIf="loading">â³ GÃ¶nderiliyor...</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- SaÄŸ: SipariÅŸ Ã–zeti -->
  <div class="col-lg-4 mb-4" *ngIf="orderSummary">
    <div class="card shadow-sm border-0">
      <div class="card-header bg-light fw-bold text-dark">ğŸ“¦ SipariÅŸ Ã–zeti</div>
      <div class="card-body text-start">
        <div class="text-center mb-3">
          <img
            [src]="orderSummary.imageUrl || 'https://via.placeholder.com/100'"
            alt="ÃœrÃ¼n"
            class="rounded"
            style="width: 100px; height: 100px; object-fit: cover;"
          />
        </div>
        <div class="mb-2"><strong>ğŸ“¦ SipariÅŸ No:</strong> #{{ orderSummary.orderNumber }}</div>
        <div class="mb-2"><strong>ğŸ›ï¸ ÃœrÃ¼n:</strong> {{ orderSummary.productTitle }}</div>
        <div class="mb-2"><strong>ğŸ”¢ Adet:</strong> {{ orderSummary.quantity || 1 }}</div>
        <div class="mb-2"><strong>ğŸ’° Tutar:</strong> {{ orderSummary.totalPrice }}</div>
        <div class="mb-2"><strong>ğŸ‘¤ MÃ¼ÅŸteri:</strong> {{ orderSummary.customerName }}</div>
        <div class="mb-2"><strong>ğŸ“ Adres:</strong> {{ orderSummary.address || '-' }}</div>
        <div><strong>ğŸšš Kargo Durumu:</strong> {{ orderSummary.shippingStatus || 'HazÄ±rlanÄ±yor' }}</div>
      </div>
    </div>
  </div>
</div>

<!-- Hata ModalÄ± -->
<app-modal
  #errorModal
  [modalConfig]="modalConfig"
  (onDismiss)="errorModal.close()"
  (onClose)="showFullError()"
>
  <p class="text-danger fw-bold">
    Ä°ÅŸlem sÄ±rasÄ±nda bir hata oluÅŸtu. DetaylarÄ± gÃ¶rmek iÃ§in "Detay GÃ¶ster"e tÄ±klayÄ±n.
  </p>
</app-modal>
